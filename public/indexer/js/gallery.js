"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw o}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}
/**
 * @license
 * 
 * <gallery-mode-plugin>
 * 
 * A plugin for <eyy-indexer> [https://github.com/sixem/eyy-indexer]
 * 
 * Licensed under GPL-3.0
 * @author   emy [admin@eyy.co]
 */
!function(u){u.fn.gallery=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},p={data:{busy:!1,scrollbreak:!1}};p.store=u.extend({extensions:{image:["jpg","jpeg","gif","png","ico","svg","bmp","webp"],video:["mp4","webm"]},console:!0,blur:!0,filter:!0,start:0,fade:0,mobile:!1,scroll_interval:35,autoplay:!0,reverse_options:!0,fit_content:!1,list:{show:!0,reverse:!1},continue:{video:null}},p.store,t),p.loadImage=function(r){return new Promise(function(e,t){var n=new Image;n.addEventListener("load",function(){return e([r,n])}),n.addEventListener("error",function(){t(new Error("failed to load image URL: ".concat(r)))}),n.src=r})},p.getExtension=function(e){return e.split(".").pop().toLowerCase()},p.getObjectSet=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return u(t.filter(function(e){return void 0!==e}).map(function(e){return u(e)}))},p.filterItems=function(e){return e.filter(function(e){return p.isImage(e.name)||p.isVideo(e.name)})},p.isImage=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return p.store.extensions.image.includes(t||p.getExtension(e))},p.isVideo=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return p.store.extensions.video.includes(t||p.getExtension(e))},p.getScrollBarWidth=function(){if(!(0<arguments.length&&void 0!==arguments[0]&&arguments[0])&&u(document).height()<=u(window).height())return 0;var e=u("<div>").css({visibility:"hidden",width:100,overflow:"scroll"}).appendTo("body"),t=u("<div>").css({width:"100%"}).appendTo(e).outerWidth();return e.remove(),100-t},p.limitBody=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=u("body"),n=u("html"),r=p.getScrollBarWidth();!0===e?(p.data.body={"max-height":t.css("max-height"),overflow:t.css("overflow")},0<r&&n.css({"padding-right":r+"px"}),t.css({"max-height":"calc(100vh - var(--height-gallery-top-bar))",overflow:"hidden"})):(Object.prototype.hasOwnProperty.call(p.data,"body")&&t.css({"max-height":p.data.body["max-height"],overflow:p.data.body.overflow}),n.css({"padding-right":"unset"}))},p.exists=function(){return p.container=u("div.gallery-container"),0<p.container.length},p.show=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;n&&(p.store.console&&console.log("itemsUpdate",!0),p.data.selected.index=null,p.items=p.store.filter?p.filterItems(n):n,p.populateTable(p.items)),!0===e?(p.bind().show(),t!==p.data.selected.index&&(p.container.find(".media .wrapper img, .media .wrapper video").hide(),p.navigate(t)),p.container.find(".list").scrollTo(p.container.find("> .list").find("tr").eq(t))):(p.unbind(p.data.bound),p.container.hide()),p.store.blur&&(p.set.blur(e),p.limitBody(e));var r,i=p.container.find(".media .wrapper video"),o=p.container.find(".list table");0<i.length&&(!0===e&&i.is(":visible")?(r=i[0].currentTime,p.store.continue.video&&i.find("source").attr("src")==p.store.continue.video.src&&(r=p.store.continue.video.time,p.store.continue.video=null),i[0].currentTime=r,i[0].muted=!1,i[0][p.store.autoplay?"play":"pause"]()):!1===e&&(i[0].muted=!0,i[0].pause())),0<o.length&&p.data.list_drag&&p.data.list_drag.css("height",o[0].scrollHeight+"px")},p.data.busy=null,p.data.busy_handle=null,p.tick=function(e){var t=parseInt(e.attr("data-tick"));return e.text("Loading "+".".repeat(t)).attr("data-tick",3<=t?1:t+1),e},p.busy=function(e){var t;return void 0!==e&&(p.data.busy=e,t=p.container.find(".media .loader"),u(t)[0].hasAttribute("data-tick")||u(t).attr("data-tick",1),e?(t.is(":hidden")&&t.stop().fadeIn(400),p.data.busy_handle=setInterval(function(){return p.tick(t)},225)):(t.is(":visible")&&t.stop().fadeOut(200,function(){return t.attr("data-tick",1).text("Loading .")}),p.data.busy||clearInterval(p.data.busy_handle))),p.data.busy},p.populateTable=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return null===t&&(t=p.container.find(".list table")),t.html(""),e.forEach(function(e){return t.append('<tr title="'.concat(e.name,'"><td>').concat(e.name,"</td></tr>"))}),p.data.list_drag.css({height:t[0].scrollHeight+"px"}),t},p.hideExisting=function(e){var t=p.container.find(e).hide();return 0<t.length?t:null},p.update={listWidth:function(e){var t=(t=0<arguments.length&&void 0!==e?e:null)||p.container.find(".media .wrapper"),n=p.data.list?p.data.list:p.container.find("div.list"),r=p.store.mobile||!n||n.is(":hidden")?0:n.outerWidth();t[0].style.setProperty("--width-list",r+"px")}},p.getReverseOptions=function(e){return{Google:"https://www.google.com/searchbyimage?image_url="+(e=encodeURIComponent(document.location.origin+e))+"&safe=off",Yandex:"https://yandex.com/images/search?rpt=imageview&url="+e,IQDB:"https://iqdb.org/?url="+e}},p.reverse=function(){if(!p.store.reverse_options||0===p.container.find(".content-container .media .wrapper .cover").length)return!1;var e=p.container.find(".content-container .media .reverse");0===e.length&&(e=u("<div/>",{class:"reverse"}).appendTo(p.container.find(".content-container .media .wrapper .cover")));var t=p.getReverseOptions(p.data.selected.src);e.html(Object.keys(t).map(function(e){return'<a class="reverse-link" target="_blank" href="'.concat(t[e],'">').concat(e,"</a>")}))},p.shortenString=function(e,t){return t=t||28,e.length>t?[e.substr(0,Math.floor(t/2-2)),e.substr(e.length-Math.floor(t/2-2),e.length)].join(" .. "):e},p.set={cache:{info:null},itemInfo:function(e,t,n,r){var i=1<arguments.length&&void 0!==t?t:null,o=2<arguments.length&&void 0!==n?n:null,a=3<arguments.length&&void 0!==r?r:null;if(p.store.console&&!e&&console.log("itemSet",i),!e)return!(p.set.cache.info=[i,o,a]);if(Array.isArray(p.set.cache.info))var l=_slicedToArray(p.set.cache.info,3),i=l[0],o=l[1],a=l[2];else if(null===i||null===o||null===a)return!1;var s=p.store.mobile?p.shortenString(i.name,30):i.name;return p.container.find(".bar > .right > a.download").attr("filename",i.name).attr("href",i.url).attr("title","Download: ".concat(i.name)),p.container.find(".bar > .left").html("<span>".concat(o+1," of ").concat(a,"</span>")+' | <a href="'.concat(i.url,'">').concat(s,"</a>")+(Object.prototype.hasOwnProperty.call(i,"size")&&!p.store.mobile?" | <span>".concat(i.size,"</span>"):"")),!0},blur:function(e){return!0===(!(0<arguments.length&&void 0!==e)||e)?p.data.blurred=u("body > *:not(.gallery-container):not(script):not(noscript):not(style)").addClass("blur ns"):Object.prototype.hasOwnProperty.call(p.data,"blurred")&&p.data.blurred.removeClass("blur ns"),p}},p.isScrolledIntoView=function(e,t){var n=e.offset().top-u(window).scrollTop();return!(n<t)&&!(n+e.outerHeight()>u(window).height())},p.scrollIntoView=function(e,t){t.stop().animate({scrollTop:e.offset().top-t.offset().top},0)},p.calculateIndex=function(e,t,n){var r=e+t;return n<r&&(r=r-n-1),r<0&&(r=n-(Math.abs(r)-1)),r<0||n<r?p.calculateIndex(e,n-r,n):r},p.video={volume:null,create:function(e){var t=u("<video/>",{controls:"",preload:"none",loop:""});return[t,u("<source>",{type:"video/"+e,src:""}).appendTo(t)]},seek:function(e){var t=p.container.find(".media .wrapper video").get(0);if(t){var n=Math.round(t.currentTime),r=Math.round(t.duration);if(0<e){if(r<n+e)return!0;t.currentTime=n+e}else if(e<0){if(n+e<0)return!0;t.currentTime=n+e}return!1}}},p.showItem=function(t,n,e,r,i){var o,a,l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,s=p.container.find(".media .wrapper");0<p.store.fade&&s.hide();function d(){p.set.itemInfo(!0);var e=s.find(0===t?"video":"img").hide();1===(p.data.selected.type=t)&&e.parent(".cover").hide(),0<p.store.fade?s.stop().fadeOut(p.store.fade,function(){s.stop().fadeIn(p.store.fade)}):s.show(),p.busy(!1)}var c,u,v,g;0===t?(o=s.find("video"),p.store.fit_content&&(c="calc(calc(100vw - var(--width-list)) / ".concat((l.img.width/l.img.height).toFixed(4),")"),p.update.listWidth(s),n.css({width:"auto",height:c}),n.parent(".cover").css("height",c)),n.attr("src",e).show(),n.parent(".cover").show(),0<o.length&&(o.off("error"),o[0].pause(),o.find("source").attr("src","")),d()):1===t&&(!1===r?(u=_slicedToArray(p.video.create(p.data.selected.ext),2),o=u[0],a=u[1],o.appendTo(s)):(a=n.find("source"),o=n),v=!1,a.attr("src",e),g=function(e){console.error("Failed to load video source.",e),p.busy(!1)},o.on("error",g),a.on("error",g),o.on("volumechange",function(){p.video.volume=o.get(0).volume}),o.on("canplay canplaythrough",function(){if(v)return!1;var e=o[0].videoHeight,t=o[0].videoWidth;p.store.fit_content&&(p.update.listWidth(s),o.css({width:"auto",height:"calc(calc(100vw - var(--width-list)) / ".concat((t/e).toFixed(4),")")})),p.video.volume&&(o.get(0).volume=p.video.volume),p.store.autoplay&&o[0].play(),o.show(),p.container.is(":visible")||(p.container.find(".media .loader").hide(),o[0].pause()),!1===r&&n.remove(),v=!0,d()}),o[0].load(),p.store.continue.video&&e==p.store.continue.video.src&&(o[0].currentTime=p.store.continue.video.time,p.store.continue.video=null)),p.data.selected.index=i},p.navigate=function(i){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(p.store.console&&console.log("busyState",p.busy()),p.busy())return!1;var t,o,n=p.items.length-1;if(null===i&&(i=p.data.selected.index),null!==e&&(i=p.calculateIndex(i,e,n)),p.data.selected.index===i||!0===p.busy())return!1;a=p.container.find(".media .wrapper img"),t=p.container.find(".media .wrapper video");var r,a,l=p.container.find(".list"),s=l.find("table"),d=s.find("tr").eq(i),c=p.items[i];return p.data.selected.src=c.url,p.data.selected.ext=p.getExtension(c.name),s.find("tr.selected").removeAttr("class"),d.attr("class","selected"),p.set.itemInfo(0===a.length&&0===t.length,c,i,1+n),p.isScrolledIntoView(d,Math.floor(p.container.find(".bar").outerHeight()-4))||l.scrollTo(d),p.isImage(null,p.data.selected.ext)?(p.busy(!0),o=0===a.length,0<t.length&&t[0].pause(),!0===o&&(r=u("<div/>",{class:"cover"}).hide().prependTo(p.container.find(".media .wrapper")),a=u("<img>").prependTo(r)),p.loadImage(c.url).then(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];p.data.selected.src===n&&p.showItem(0,a,n,o,i,{img:r})}).catch(function(e){p.busy(!1),console.error(e)}),!0):p.isVideo(null,p.data.selected.ext)?(p.busy(!0),(o=0===t.length)&&(t=p.video.create(p.data.selected.ext)[0]).appendTo(p.container.find(".media .wrapper")),p.showItem(1,t,c.url,o,i),!0):void 0},p.data.key_prevent=[33,34,37,38,39,40,71],p.handleKey=function(e,t){p.store.console&&console.log("handleKey",e),27===e?p.show(!1):40===e||34===e||39===e?39===e&&1===p.data.selected.type&&!p.video.seek(5)||p.navigate(null,1):38===e||33===e||37===e?37===e&&1===p.data.selected.type&&!p.video.seek(-5)||p.navigate(null,-1):76===e&&p.toggleList(),t(p.data.key_prevent.includes(e))},p.unbind=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];e.forEach(function(e){return Object.prototype.hasOwnProperty.call(e,"direct")&&!0===e.direct?(u(e.trigger).off(e.event),!0):void(e.trigger?u(document).off(e.event,e.trigger):u(document).off(e.event))}),!0===t&&u(p).trigger("unbound",!0)},p.scrollBreak=function(){p.data.scrollbreak=!1},p.toggleList=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=p.container.find(".list"),n=t.is(":visible"),r=JSON.parse(Cookies.get("ei-client"));return r.gallery.list_state=n?0:1,Cookies.set("ei-client",JSON.stringify(r),{sameSite:"lax",expires:365}),(e=e||u('.gallery-container div.bar .right span[data-action="toggle"]')).text("List"+(n?"+":"-")),t.css("display",n?"none":"table-cell"),p.update.listWidth(),!n},p.bind=function(){return p.data.bound=[{event:"click",trigger:"div.gallery-container .list table tr"},{event:"click",trigger:'div.gallery-container [data-action="close"]'},{event:"click",trigger:'div.gallery-container [data-action="toggle"]'},{event:"click",trigger:'div.gallery-container [data-action="previous"]'},{event:"click",trigger:'div.gallery-container [data-action="next"]'},{event:"click",trigger:"div.gallery-container .media"},{event:"DOMMouseScroll mousewheel",trigger:"div.gallery-container .media"},{event:"mouseover",trigger:"div.gallery-container .media .wrapper img"},{event:"mouseleave",trigger:"div.gallery-container .media .wrapper img"},{event:"mouseenter",trigger:"div.gallery-container .media .wrapper .cover"},{event:"swipeleft",trigger:"div.gallery-container",direct:!0},{event:"swiperight",trigger:"div.gallery-container",direct:!0},{event:"mouseup",trigger:".gallery-container"},{event:"keydown",trigger:null},{event:"keyup",trigger:null}],p.unbind(p.data.bound,!1),p.data.list_drag.on("mousedown",function(){p.data.list_dragged=!0;var r=window.innerWidth,e=p.container.find(".media .wrapper");u("body").css("cursor","w-resize"),e.css("pointer-events","none"),u(document).on("mousemove",".gallery-container",function(e){var t,n=e.originalEvent.clientX;n<r&&(t=p.store.list.reverse?n+p.data.scrollbar_width:r-n,p.data.list.css("width",t+"px"))})}),u(document).on("mouseup",".gallery-container",function(){var e,t,n;!0===p.data.list_dragged&&(u(document).off("mousemove",".gallery-container"),e=p.container.find(".media .wrapper"),u("body").css("cursor",""),e.css("pointer-events","auto"),100<(t=parseInt(p.data.list.css("width").replace(/[^-\d.]/g,"")))&&((n=JSON.parse(Cookies.get("ei-client"))).gallery.list_width=t,Cookies.set("ei-client",JSON.stringify(n),{sameSite:"lax",expires:365}),p.update.listWidth(e)))}),u(document).on("click",'div.gallery-container [data-action="close"]',function(){p.show(!1)}),u(document).on("click",'div.gallery-container [data-action="toggle"]',function(e){p.toggleList(u(e.currentTarget))}),u(document).on("click",'div.gallery-container [data-action="previous"]',function(){p.navigate(null,-1)}),u(document).on("click",'div.gallery-container [data-action="next"]',function(){p.navigate(null,1)}),u(document).on("click","div.gallery-container .list table tr",function(e){p.navigate(u(e.currentTarget).index())}),u(document).on("click","div.gallery-container .media",function(e){u(e.target).is("img, video, a")||p.show(!1)}),!0===p.store.reverse_options&&u(document).on("mouseenter","div.gallery-container .media .wrapper .cover",function(e){p.reverse(u(e.currentTarget))}),!0===p.store.mobile&&(u("div.gallery-container").on("swipeleft",function(){return p.navigate(null,1)}),u("div.gallery-container").on("swiperight",function(){return p.navigate(null,-1)})),u(document).on("DOMMouseScroll mousewheel","div.gallery-container .media",function(e){return!(0<p.store.scroll_interval&&!0===p.data.scrollbreak)&&(p.navigate(null,0<e.originalEvent.detail||e.originalEvent.wheelDelta<0?1:-1),void(0<p.store.scroll_interval&&(p.data.scrollbreak=!0,setTimeout(function(){return p.scrollBreak()},p.store.scroll_interval))))}),u(document).on("keydown",u.fn,function(e){p.data.key_prevent.includes(e.keyCode)&&e.preventDefault(),71===e.keyCode&&p.show(!1)}),u(document).on("keyup",u.fn,function(t){p.handleKey(t.keyCode,function(e){e&&t.preventDefault()})}),u(p).trigger("bound",!0),p.container},p.barConstruct=function(e){u("<a/>",{text:p.store.mobile?"Save":"Download",class:"download",download:""}).appendTo(e),p.store.mobile||u("<span/>",{"data-action":"previous",text:"Previous"}).appendTo(e),p.store.mobile||u("<span/>",{"data-action":"next",text:"Next"}).appendTo(e),p.store.mobile||u("<span/>",{"data-action":"toggle",text:p.store.list.show?"List-":"List+"}).appendTo(e),u("<span/>",{"data-action":"close",text:"Close"}).appendTo(e)};return p.container=u("div.gallery-container"),p.items=p.store.filter?p.filterItems(e):e,0!==p.items.length&&(p.data.selected={src:null,ext:null,index:null,type:null},p.exists()?p.show(!0):function(e){p.limitBody(!0);var t=u("body").find("#image-preview, #video-preview");0<t.length&&t.remove(),p.container=u("<div/>",{class:"gallery-container"}).prependTo("body");var n=u("<div/>",{class:"bar"}).appendTo(p.container);u("<div/>",{class:"left"}).appendTo(n),p.barConstruct(u("<div/>",{class:"right"}).appendTo(n));var r=u("<div/>",{class:"content-container"}).appendTo(p.container),i=u("<div/>",{class:"media"}),o=u("<div/>",{class:"ns list"+(p.store.list.reverse?" reversed":"")});r.append(p.store.list.reverse?o:i).append(p.store.list.reverse?i:o),p.data.list_drag=u("<div/>",{class:"drag"+(p.store.list.reverse?" reversed":"")}).appendTo(o),p.data.list=o,p.data.list_dragged=!1,p.data.scrollbar_width=p.getScrollBarWidth(!0);var a=JSON.parse(Cookies.get("ei-client"));try{var l=JSON.parse(a.gallery.list_width.toString().toLowerCase());!1===l?l="":parseInt(l)>window.innerWidth/2&&(a.gallery.list_width=Math.floor(window.innerWidth/2),Cookies.set("ei-client",JSON.stringify(a),{sameSite:"lax",expires:365})),p.data.list.css("width",l)}catch(e){a.gallery.list_width=!1,Cookies.set("ei-client",JSON.stringify(a),{sameSite:"lax",expires:365})}p.store.list.show||o.hide(),!0===p.store.mobile&&(o.hide(),u("<span/>",{}).appendTo(u("<div/>",{class:"screen-nav left","data-action":"previous"}).appendTo(r)),u("<span/>",{}).appendTo(u("<div/>",{class:"screen-nav right","data-action":"next"}).appendTo(r))),u("<div/>",{class:"wrapper"+(p.store.fit_content?" fill":"")}).appendTo(i),u("<div/>",{class:"loader"+(p.store.list.reverse?" reversed":"")}).html("Loading ..").appendTo(i),u("<tbody/>").appendTo(u("<table/>",{cellspacing:"0"}).appendTo(o)),p.populateTable(p.items),e(!0)}(function(){p.store.blur&&p.set.blur(!0).bind()}),p.navigate(p.store.start>p.items.length-1?p.items.length-1:p.store.start),p)}}(jQuery);